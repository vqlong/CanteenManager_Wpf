PRAGMA foreign_keys=OFF;
BEGIN TRANSACTION;
CREATE TABLE Account
(	
    UserName NVARCHAR(100) PRIMARY KEY,
    DisplayName NVARCHAR(100) NOT NULL DEFAULT 'CafeNo1',
    PassWord NVARCHAR(1000) NOT NULL DEFAULT '952362351022552001115621782120108109105108121194219194572217814518010341215583925187233',
    AccType INT NOT NULL DEFAULT 0 --1: Admin && 0: Staff 
);
INSERT INTO Account VALUES('admin','Quán chủ','1661011648932664715765126721032392207918416074316325531160126153142134247247162122227',1);
INSERT INTO Account VALUES('hien','Vợ chủ quán','952362351022552001115621782120108109105108121194219194572217814518010341215583925187233',1);
INSERT INTO Account VALUES('nv01','CafeNo1','952362351022552001115621782120108109105108121194219194572217814518010341215583925187233',0);
CREATE TABLE TableFood
(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    Name NVARCHAR(100) NOT NULL DEFAULT 'Chưa đặt tên',
    TableStatus NVARCHAR(100) NOT NULL DEFAULT 'Trống', --Trống || Có người
    UsingState INT NOT NULL DEFAULT 1 --1: Đang dùng && 0: Không dùng
);
INSERT INTO TableFood VALUES(1,'Bàn VIP','Trống',1);
INSERT INTO TableFood VALUES(2,'Bàn cực VIP','Trống',1);
INSERT INTO TableFood VALUES(3,'Bàn 3','Trống',1);
INSERT INTO TableFood VALUES(4,'Bàn 4','Trống',1);
INSERT INTO TableFood VALUES(5,'Bàn 5','Trống',1);
INSERT INTO TableFood VALUES(6,'Bàn 6','Trống',1);
INSERT INTO TableFood VALUES(7,'Bàn 7','Trống',1);
INSERT INTO TableFood VALUES(8,'Bàn 8','Trống',1);
INSERT INTO TableFood VALUES(9,'Bàn 9','Trống',1);
INSERT INTO TableFood VALUES(10,'Bàn 10','Trống',1);
INSERT INTO TableFood VALUES(11,'Bàn 11','Trống',1);
INSERT INTO TableFood VALUES(12,'Bàn 12','Trống',1);
INSERT INTO TableFood VALUES(13,'Bàn 13','Trống',1);
INSERT INTO TableFood VALUES(14,'Bàn 14','Trống',1);
INSERT INTO TableFood VALUES(15,'Bàn 15','Trống',1);
INSERT INTO TableFood VALUES(16,'Bàn 16','Trống',1);
INSERT INTO TableFood VALUES(17,'Bàn 17','Trống',1);
INSERT INTO TableFood VALUES(18,'Bàn 18','Trống',1);
INSERT INTO TableFood VALUES(19,'Bàn 19','Trống',1);
INSERT INTO TableFood VALUES(20,'Bàn 20','Trống',1);
INSERT INTO TableFood VALUES(21,'Bàn 21','Trống',0);
INSERT INTO TableFood VALUES(22,'Bàn 22','Trống',0);
INSERT INTO TableFood VALUES(23,'Bàn 23','Trống',0);
INSERT INTO TableFood VALUES(24,'Bàn 24','Trống',0);
INSERT INTO TableFood VALUES(25,'Bàn 25','Trống',0);
INSERT INTO TableFood VALUES(26,'Bàn 26','Trống',0);
INSERT INTO TableFood VALUES(27,'Bàn 27','Trống',0);
INSERT INTO TableFood VALUES(28,'Bàn 28','Trống',0);
INSERT INTO TableFood VALUES(29,'Bàn 29','Trống',0);
INSERT INTO TableFood VALUES(30,'Bàn 30','Trống',0);
INSERT INTO TableFood VALUES(31,'Bàn 31','Trống',1);
INSERT INTO TableFood VALUES(32,'Bàn 32','Trống',1);
INSERT INTO TableFood VALUES(33,'Bàn 33','Trống',1);
INSERT INTO TableFood VALUES(34,'Bàn 34','Trống',1);
INSERT INTO TableFood VALUES(35,'Bàn 35','Trống',1);
INSERT INTO TableFood VALUES(36,'Bàn 36','Trống',1);
CREATE TABLE FoodCategory
(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    Name NVARCHAR(100) NOT NULL DEFAULT 'Chưa đặt tên',
    CategoryStatus INT NOT NULL DEFAULT 1 --1: Đang bán && 0: Không bán
);
INSERT INTO FoodCategory VALUES(1,'Món ăn',1);
INSERT INTO FoodCategory VALUES(2,'Hoa quả',1);
INSERT INTO FoodCategory VALUES(3,'Nước',1);
INSERT INTO FoodCategory VALUES(4,'Chè',1);
INSERT INTO FoodCategory VALUES(5,'Cháo',1);
INSERT INTO FoodCategory VALUES(6,'Thuốc',1);
CREATE TABLE Food
(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    Name NVARCHAR(100) NOT NULL DEFAULT 'Chưa đặt tên',
    CategoryID INT NOT NULL,
    Price DOUBLE NOT NULL DEFAULT 0,
    FoodStatus INT NOT NULL DEFAULT 1, --1: Đang bán && 0: Không bán

    FOREIGN KEY (CategoryID) REFERENCES FoodCategory(ID)
);
INSERT INTO Food VALUES(1,'Tiết canh',1,4953.0,1);
INSERT INTO Food VALUES(2,'Cánh gà nướng',1,25000.0,0);
INSERT INTO Food VALUES(3,'Ốc xào xả ớt',1,18000.0,1);
INSERT INTO Food VALUES(4,'Nem chua rán',1,19000.0,1);
INSERT INTO Food VALUES(5,'Cam',2,8000.0,1);
INSERT INTO Food VALUES(6,'Quýt',2,7000.0,1);
INSERT INTO Food VALUES(7,'Mít',2,6000.0,1);
INSERT INTO Food VALUES(8,'Dừa',2,9000.0,1);
INSERT INTO Food VALUES(9,'Dưa',2,5000.0,1);
INSERT INTO Food VALUES(10,'Dứa',2,2000.0,1);
INSERT INTO Food VALUES(11,'Ổi',2,3000.0,1);
INSERT INTO Food VALUES(12,'Cocacola',3,10000.0,1);
INSERT INTO Food VALUES(13,'Pepsi',3,11000.0,1);
INSERT INTO Food VALUES(14,'Bia',3,12000.0,1);
INSERT INTO Food VALUES(15,'Sữa chua mít',3,13000.0,1);
INSERT INTO Food VALUES(16,'Chè bưởi',4,15000.0,1);
INSERT INTO Food VALUES(17,'Cháo lòng',5,25000.0,1);
INSERT INTO Food VALUES(18,'Cháo lưỡi',5,69996.0,1);
INSERT INTO Food VALUES(19,'Su su luộc chấm muối vừng',1,99999.0,1);
INSERT INTO Food VALUES(20,'Chè sầu',4,8888.0,1);
INSERT INTO Food VALUES(21,'Thuốc lá',6,7777.0,1);
INSERT INTO Food VALUES(22,'Thuốc lào',6,555.0,1);
INSERT INTO Food VALUES(23,'Thuốc phiện',6,7878.0,1);
INSERT INTO Food VALUES(24,'Chè đỗ đen',4,9898.0,1);
INSERT INTO Food VALUES(25,'Chè tươi Thái Nguyên',4,6868.0,1);
INSERT INTO Food VALUES(26,'Nước lã',3,12321.0,1);
INSERT INTO Food VALUES(27,'Yakult',3,7999.0,1);
INSERT INTO Food VALUES(28,'Lavie',3,999.0,1);
INSERT INTO Food VALUES(29,'Thuốc lắc',6,8899.0,1);
INSERT INTO Food VALUES(30,'Chè xanh',4,500.0,1);
INSERT INTO Food VALUES(31,'Cháo bẹ măng tre',5,9669.0,1);
INSERT INTO Food VALUES(32,'Đậu luộc',1,6677.0,1);
CREATE TABLE Bill (ID INTEGER PRIMARY KEY AUTOINCREMENT, DateCheckIn NVARCHAR (100) NOT NULL DEFAULT (strftime('%Y-%m-%d %H:%M:%f', 'now', 'localtime')), DateCheckOut NVARCHAR (100), TableID INT NOT NULL, BillStatus INT NOT NULL DEFAULT 0, Discount INT NOT NULL DEFAULT 0, TotalPrice DOUBLE NOT NULL DEFAULT 0, FOREIGN KEY (TableID) REFERENCES TableFood (ID));
INSERT INTO Bill VALUES(1,'2022-06-20 23:27:52.373','2022-06-20 23:28:11.783',1,1,69,18600.0);
INSERT INTO Bill VALUES(2,'2022-06-20 23:55:06.967','2022-06-20 23:55:12.220',2,1,0,60000.0);
INSERT INTO Bill VALUES(4,'2022-06-20 23:59:24.917','2022-06-20 23:59:31.667',4,1,0,60000.0);
INSERT INTO Bill VALUES(5,'2022-06-21 00:03:31.570','2022-06-21 00:03:39.813',6,1,69,23250.0);
INSERT INTO Bill VALUES(6,'2022-06-21 00:14:50.160','2022-06-21 00:14:56.020',7,1,0,25000.0);
INSERT INTO Bill VALUES(7,'2022-06-21 00:23:10.563','2022-06-21 00:25:39.610',10,1,0,45000.0);
INSERT INTO Bill VALUES(8,'2022-06-21 00:23:13.110','2022-06-21 00:26:01.030',11,1,0,45000.0);
INSERT INTO Bill VALUES(9,'2022-06-21 00:23:14.910','2022-06-21 00:26:13.973',12,1,0,45000.0);
INSERT INTO Bill VALUES(10,'2022-06-21 00:28:42.373','2022-06-21 00:29:14.143',6,1,0,32000.0);
INSERT INTO Bill VALUES(11,'2022-06-21 00:28:54.793','2022-06-21 00:29:47.173',7,1,0,40000.0);
INSERT INTO Bill VALUES(12,'2022-06-21 00:28:57.347','2022-06-21 00:30:04.440',8,1,0,48000.0);
INSERT INTO Bill VALUES(13,'2022-07-21 00:34:06.650','2022-07-23 22:05:02.690',6,1,0,36000.0);
INSERT INTO Bill VALUES(14,'2022-07-21 00:34:10.540','2022-07-22 17:15:35.083',10,1,1,47520.0);
INSERT INTO Bill VALUES(15,'2022-07-21 00:34:17.340','2022-07-22 17:15:27.943',12,1,0,57000.0);
INSERT INTO Bill VALUES(16,'2022-07-21 00:34:22.117','2022-07-22 17:15:24.807',8,1,0,30000.0);
INSERT INTO Bill VALUES(17,'2022-08-21 00:49:30.460','2022-08-27 22:16:03.150',7,1,99,7049.939999999939573);
INSERT INTO Bill VALUES(19,'2022-08-21 00:52:04.197','2022-08-23 22:05:58.830',14,1,0,73225.0);
INSERT INTO Bill VALUES(20,'2022-08-21 00:52:13.713','2022-08-22 17:15:44.900',9,1,2,61519.499999999999999);
INSERT INTO Bill VALUES(23,'2022-08-21 00:55:03.117','2022-08-23 22:05:45.623',16,1,0,39995.0);
INSERT INTO Bill VALUES(24,'2022-08-24 23:12:13.103','2022-08-24 23:12:17.247',6,1,0,39995.0);
INSERT INTO Bill VALUES(27,'2022-08-30 14:48:05.260','2022-08-30 14:48:11.037',1,1,0,98568.0);
INSERT INTO Bill VALUES(28,'2022-08-30 14:49:07.017','2022-08-30 14:49:11.470',1,1,0,3000.0);
INSERT INTO Bill VALUES(29,'2022-09-01 17:19:48.200','2022-09-01 17:29:59.683',10,1,0,220000.0);
INSERT INTO Bill VALUES(30,'2022-09-01 17:31:08.623','2022-09-01 17:48:36.407',20,1,0,520000.0);
INSERT INTO Bill VALUES(31,'2022-09-01 19:05:25.963','2022-09-01 21:29:46.027',10,1,0,616050.0);
INSERT INTO Bill VALUES(32,'2022-09-02 01:02:03.967','2022-09-02 01:02:08.987',6,1,0,199975.0);
INSERT INTO Bill VALUES(33,'2022-09-02 19:14:02.437','2022-09-02 20:26:33.957',18,1,3,803579.04000000003729);
INSERT INTO Bill VALUES(34,'2022-09-02 23:41:14.177','2022-09-02 23:42:52.777',6,1,8,7121062.200000000186);
INSERT INTO Bill VALUES(35,'2022-09-03 12:53:19.113','2022-09-03 12:53:57.827',9,1,69,53953.019999999996796);
INSERT INTO Bill VALUES(36,'2022-09-03 13:07:58.490','2022-09-03 13:08:03.193',7,1,0,29007.0);
INSERT INTO Bill VALUES(37,'2022-09-03 15:01:32.940','2022-09-03 15:01:35.770',14,1,0,29007.0);
INSERT INTO Bill VALUES(38,'2022-09-03 15:12:13.113','2022-09-03 15:12:16.430',12,1,0,61605.0);
INSERT INTO Bill VALUES(39,'2022-09-03 15:15:54.483','2022-09-06 11:29:42.140',12,1,0,12321.0);
INSERT INTO Bill VALUES(44,'2022-09-18 00:02:31.596','2022-09-18 00:12:52.605',2,1,88,24037.20000000001164);
INSERT INTO Bill VALUES(45,'2022-09-18 20:26:24.044','2022-09-19 01:38:12.606',7,1,0,6677.0);
INSERT INTO Bill VALUES(47,'2022-09-19 00:12:35.132','2022-09-19 01:37:52.291',6,1,0,304813.0);
INSERT INTO Bill VALUES(50,'2022-09-19 01:55:25.235','2022-09-19 01:57:27.302',10,1,0,240060.0);
INSERT INTO Bill VALUES(51,'2022-09-19 01:55:35.685','2022-09-19 01:56:48.564',6,1,0,399996.0);
INSERT INTO Bill VALUES(55,'2022-09-19 02:10:54.021','2022-09-19 02:17:45.699',6,1,0,739022.0);
INSERT INTO Bill VALUES(58,'2022-09-19 17:56:55.892','2022-09-19 17:58:05.918',1,1,1,117808.02000000000407);
INSERT INTO Bill VALUES(59,'2022-09-19 18:00:55.519','2022-09-19 18:01:23.714',11,1,2,685993.14000000001395);
INSERT INTO Bill VALUES(60,'2022-09-19 18:27:27.638','2022-09-19 18:27:54.853',16,1,3,75031.440000000002329);
INSERT INTO Bill VALUES(61,'2022-09-19 18:28:10.852','2022-09-19 18:28:13.587',14,1,0,58014.0);
CREATE TABLE BillInfo (ID INTEGER PRIMARY KEY AUTOINCREMENT, BillID INT NOT NULL REFERENCES Bill (ID), FoodID INT NOT NULL REFERENCES Food (ID), FoodCount INT NOT NULL DEFAULT 0, FOREIGN KEY (BillID) REFERENCES Bill (ID), FOREIGN KEY (FoodID) REFERENCES Food (ID));
INSERT INTO BillInfo VALUES(1,1,18,4);
INSERT INTO BillInfo VALUES(2,2,1,4);
INSERT INTO BillInfo VALUES(4,4,16,4);
INSERT INTO BillInfo VALUES(5,5,18,5);
INSERT INTO BillInfo VALUES(6,6,2,1);
INSERT INTO BillInfo VALUES(7,7,16,3);
INSERT INTO BillInfo VALUES(8,8,16,3);
INSERT INTO BillInfo VALUES(9,9,16,3);
INSERT INTO BillInfo VALUES(10,10,5,4);
INSERT INTO BillInfo VALUES(11,11,5,5);
INSERT INTO BillInfo VALUES(12,12,5,6);
INSERT INTO BillInfo VALUES(13,13,1,3);
INSERT INTO BillInfo VALUES(14,14,1,4);
INSERT INTO BillInfo VALUES(15,15,4,3);
INSERT INTO BillInfo VALUES(16,16,12,3);
INSERT INTO BillInfo VALUES(17,17,19,6);
INSERT INTO BillInfo VALUES(18,17,7,5);
INSERT INTO BillInfo VALUES(19,17,16,5);
INSERT INTO BillInfo VALUES(22,19,25,5);
INSERT INTO BillInfo VALUES(23,19,21,5);
INSERT INTO BillInfo VALUES(24,20,22,5);
INSERT INTO BillInfo VALUES(25,20,14,5);
INSERT INTO BillInfo VALUES(28,23,27,5);
INSERT INTO BillInfo VALUES(29,24,27,5);
INSERT INTO BillInfo VALUES(33,27,26,8);
INSERT INTO BillInfo VALUES(34,28,30,6);
INSERT INTO BillInfo VALUES(35,29,13,20);
INSERT INTO BillInfo VALUES(36,30,15,40);
INSERT INTO BillInfo VALUES(37,31,26,50);
INSERT INTO BillInfo VALUES(38,32,27,25);
INSERT INTO BillInfo VALUES(39,33,19,6);
INSERT INTO BillInfo VALUES(40,33,26,18);
INSERT INTO BillInfo VALUES(41,33,22,12);
INSERT INTO BillInfo VALUES(42,34,19,21);
INSERT INTO BillInfo VALUES(43,34,5,21);
INSERT INTO BillInfo VALUES(44,34,6,21);
INSERT INTO BillInfo VALUES(45,34,7,21);
INSERT INTO BillInfo VALUES(46,34,8,21);
INSERT INTO BillInfo VALUES(47,34,9,21);
INSERT INTO BillInfo VALUES(48,34,10,21);
INSERT INTO BillInfo VALUES(49,34,11,21);
INSERT INTO BillInfo VALUES(50,34,12,21);
INSERT INTO BillInfo VALUES(51,34,13,21);
INSERT INTO BillInfo VALUES(52,34,14,21);
INSERT INTO BillInfo VALUES(53,34,15,21);
INSERT INTO BillInfo VALUES(54,34,26,21);
INSERT INTO BillInfo VALUES(55,34,27,21);
INSERT INTO BillInfo VALUES(56,34,28,21);
INSERT INTO BillInfo VALUES(57,34,16,21);
INSERT INTO BillInfo VALUES(58,34,20,21);
INSERT INTO BillInfo VALUES(59,34,24,21);
INSERT INTO BillInfo VALUES(60,34,25,21);
INSERT INTO BillInfo VALUES(61,34,30,21);
INSERT INTO BillInfo VALUES(62,34,17,21);
INSERT INTO BillInfo VALUES(63,34,18,21);
INSERT INTO BillInfo VALUES(64,34,21,21);
INSERT INTO BillInfo VALUES(65,34,22,21);
INSERT INTO BillInfo VALUES(66,34,23,21);
INSERT INTO BillInfo VALUES(67,34,29,21);
INSERT INTO BillInfo VALUES(68,35,31,18);
INSERT INTO BillInfo VALUES(69,36,31,3);
INSERT INTO BillInfo VALUES(70,37,31,3);
INSERT INTO BillInfo VALUES(71,38,26,5);
INSERT INTO BillInfo VALUES(72,39,26,1);
INSERT INTO BillInfo VALUES(75,44,32,30);
INSERT INTO BillInfo VALUES(76,45,32,1);
INSERT INTO BillInfo VALUES(79,47,26,5);
INSERT INTO BillInfo VALUES(82,47,25,21);
INSERT INTO BillInfo VALUES(83,47,24,10);
INSERT INTO BillInfo VALUES(86,50,32,6);
INSERT INTO BillInfo VALUES(87,51,19,4);
INSERT INTO BillInfo VALUES(88,50,19,2);
INSERT INTO BillInfo VALUES(90,55,32,4);
INSERT INTO BillInfo VALUES(91,55,19,7);
INSERT INTO BillInfo VALUES(92,55,26,1);
INSERT INTO BillInfo VALUES(93,58,12,7);
INSERT INTO BillInfo VALUES(94,58,13,3);
INSERT INTO BillInfo VALUES(95,58,27,2);
INSERT INTO BillInfo VALUES(96,59,19,7);
INSERT INTO BillInfo VALUES(97,60,31,8);
INSERT INTO BillInfo VALUES(98,61,31,6);
DELETE FROM sqlite_sequence;
INSERT INTO sqlite_sequence VALUES('TableFood',36);
INSERT INTO sqlite_sequence VALUES('FoodCategory',6);
INSERT INTO sqlite_sequence VALUES('Food',32);
INSERT INTO sqlite_sequence VALUES('Bill',62);
INSERT INTO sqlite_sequence VALUES('BillInfo',99);
CREATE TRIGGER UTG_InsertBill AFTER INSERT
ON Bill
BEGIN
    UPDATE TableFood SET TableStatus = 'Có người' WHERE ID = new.TableID AND new.BillStatus = 0;
END;
CREATE TRIGGER UTG_DeleteBill AFTER DELETE
ON Bill
BEGIN
    UPDATE TableFood SET TableStatus = 'Trống' WHERE ID = old.TableID AND old.BillStatus = 0;
END;
CREATE TRIGGER [UTG_UpdateBill]
         AFTER UPDATE
            ON [Bill]
BEGIN
--Khi thanh toán (thay đổi BillStatus = 1)
    UPDATE [TableFood]
       SET [TableStatus] = 'Trống'
     WHERE [ID] = [old].[TableID] AND 
           [ID] = [new].[TableID] AND 
           [old].[BillStatus] = 0 AND 
           [new].[BillStatus] = 1;
           
--Khi chuyển bản (thay đổi TableID)

    UPDATE [TableFood]
       SET [TableStatus] = 'Có người'
     WHERE [ID] = [new].[TableID] AND 
           [old].[TableID] != [new].[TableID] AND 
           [old].[BillStatus] = 0 AND 
           [new].[BillStatus] = 0;
           
UPDATE [TableFood]
   SET [TableStatus] = 'Trống'
 WHERE [ID] = [old].[TableID] AND 
       (
           SELECT count( * ) 
             FROM [Bill]
            WHERE [TableID] = [old].[TableID] AND 
                  [BillStatus] = 0
       )
=      0;

END
;
COMMIT;
